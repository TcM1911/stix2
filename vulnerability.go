// Copyright 2020 Joakim Kennedy. All rights reserved. Use of
// this source code is governed by the included BSD license.

package stix2

// Vulnerability is "a mistake in software that can be directly used by a
// hacker to gain access to a system or network". For example, if a piece of
// malware exploits CVE-2015-12345, a Malware object could be linked to a
// Vulnerability object that references CVE-2015-12345. CVE is a list of
// information security vulnerabilities and exposures that provides common
// names for publicly known problems.
//
// The Vulnerability SDO is primarily used to link to external definitions of
// vulnerabilities or to describe 0-day vulnerabilities that do not yet have an
// external definition. Typically, other SDOs assert relationships to
// Vulnerability objects when a specific vulnerability is targeted and
// exploited as part of malicious cyber activity. As such, Vulnerability
// objects can be used as a linkage to the asset management and compliance
// process.
type Vulnerability struct {
	STIXDomainObject
	// Name is used to identify the Vulnerability.
	Name string `json:"name"`
	// Description provides more details and context about the Vulnerability,
	// potentially including its purpose and its key characteristics.
	Description string `json:"description,omitempty"`
}

// NewVulnerability creates a new Vulnerability object.
func NewVulnerability(name string, opts ...VulnerabilityOption) (*Vulnerability, error) {
	if name == "" {
		return nil, ErrPropertyMissing
	}
	base := newSTIXDomainObject(TypeVulnerability)
	obj := &Vulnerability{
		STIXDomainObject: base,
		Name:             name,
	}

	for _, opt := range opts {
		if opt == nil {
			continue
		}
		opt(obj)
	}
	return obj, nil
}

// VulnerabilityOption is an optional parameter when constructing a
// Vulnerability object.
type VulnerabilityOption func(a *Vulnerability)

/*
	Base object options
*/

// VulnerabilityOptionSpecVersion sets the STIX spec version.
func VulnerabilityOptionSpecVersion(ver string) VulnerabilityOption {
	return func(obj *Vulnerability) {
		obj.SpecVersion = ver
	}
}

// VulnerabilityOptionExternalReferences sets the external references attribute.
func VulnerabilityOptionExternalReferences(refs []*ExternalReference) VulnerabilityOption {
	return func(obj *Vulnerability) {
		obj.ExternalReferences = refs
	}
}

// VulnerabilityOptionObjectMarking sets the object marking attribute.
func VulnerabilityOptionObjectMarking(om []Identifier) VulnerabilityOption {
	return func(obj *Vulnerability) {
		obj.ObjectMarking = om
	}
}

// VulnerabilityOptionGranularMarking sets the granular marking attribute.
func VulnerabilityOptionGranularMarking(gm *GranularMarking) VulnerabilityOption {
	return func(obj *Vulnerability) {
		obj.GranularMarking = gm
	}
}

// VulnerabilityOptionLang sets the lang attribute.
func VulnerabilityOptionLang(lang string) VulnerabilityOption {
	return func(obj *Vulnerability) {
		obj.Lang = lang
	}
}

// VulnerabilityOptionConfidence sets the confidence attribute.
func VulnerabilityOptionConfidence(confidence int) VulnerabilityOption {
	return func(obj *Vulnerability) {
		obj.Confidence = confidence
	}
}

// VulnerabilityOptionLables sets the lables attribute.
func VulnerabilityOptionLables(lables []string) VulnerabilityOption {
	return func(obj *Vulnerability) {
		obj.Lables = lables
	}
}

// VulnerabilityOptionRevoked sets the revoked attribute.
func VulnerabilityOptionRevoked(rev bool) VulnerabilityOption {
	return func(obj *Vulnerability) {
		obj.Revoked = rev
	}
}

// VulnerabilityOptionModified sets the modified attribute.
func VulnerabilityOptionModified(t *Timestamp) VulnerabilityOption {
	return func(obj *Vulnerability) {
		obj.Modified = t
	}
}

// VulnerabilityOptionCreated sets the created attribute.
func VulnerabilityOptionCreated(t *Timestamp) VulnerabilityOption {
	return func(obj *Vulnerability) {
		obj.Created = t
	}
}

// VulnerabilityOptionCreatedBy sets the created by by attribute.
func VulnerabilityOptionCreatedBy(id Identifier) VulnerabilityOption {
	return func(obj *Vulnerability) {
		obj.CreatedBy = id
	}
}

/*
	Vulnerability object options
*/

// VulnerabilityOptionDescription sets the description attribute.
func VulnerabilityOptionDescription(s string) VulnerabilityOption {
	return func(obj *Vulnerability) {
		obj.Description = s
	}
}
